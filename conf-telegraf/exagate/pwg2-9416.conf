[[inputs.snmp]]

  agents = ["udp://192.168.0.155:161"]

  version = 2
  community = "v1read"
  
  #path = ["/usr/share/snmp/mibs"]

  [[inputs.snmp.field]]
    oid = "RFC1213-MIB::sysUpTime.0"
    name = "uptime"

  [[inputs.snmp.field]]
    oid = "EXAGATE-GLOBAL-REG::systemName.1"
    name = "name"
    is_tag = true
 
 [[inputs.snmp.table]]
    oid = "EXAGATE-GLOBAL-REG::circuitsTable"
    name = "PWG-9332-307-91-SIPH"
    inherit_tags = ["name"]
    index_as_tag = true

 [[inputs.snmp.table]]
    oid = "EXAGATE-GLOBAL-REG::phasesTable"
    name = "PWG-9332-307-91-SIPH"
    inherit_tags = ["name"]
    index_as_tag = true

[[inputs.snmp.table]]
    oid = "EXAGATE-GLOBAL-REG::portsTable"
    name = "PWG-9332-307-91-SIPH"
    inherit_tags = ["name"]
    index_as_tag = true
    
      
     
[[processors.starlark]]
 # Reads the Starlark script embedded

  source = '''
  
load("logging.star", "log")
def apply(metric):
  
    
## EXAGATE SIPH
  if "PWG2-9416" in  metric.tags.get('name') and "circuitName" in metric.fields:

    m = metric.fields["circuitValue"]
    id= metric.fields["circuitName"]
    id2= id.replace(' ','-')

    #id2=id.replace(" ",""-")

    #for c in id:
    #    if c == " ":
    #        id2 += "-"
    #    else:
    #        id2 += c


    metric.fields.clear()
    metric.fields[id2]=m

    return metric

  if "PWG2-9416" in  metric.tags.get('name') and "phaseName" in metric.fields:

    m = metric.fields["phaseValue"]
    id= metric.fields["phaseName"]
    id2= id.replace(' ','-')

    metric.fields.clear()
    metric.fields[id2]=m

    return metric

  if "PWG2-9416" in  metric.tags.get('name') and "portName" in metric.fields:

    m = metric.fields["portValue"]
    id= metric.fields["portName"]
    id2= id.replace(' ','-')

    metric.fields.clear()
    metric.fields[id2]=m

    return metric


  
  return metric
'''
